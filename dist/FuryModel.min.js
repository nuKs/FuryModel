!function(){"use strict";function t(t){this._remoteData=null,this._eventQueue={loaded:[],created:[],deleted:[]},this._filteredProperties=["_pk","_eventQueue","_filteredProperties","_init","_load","_create","_update","_delete","_process","_unprocess","$reset","$save","$delete","$raw","$once"],this._pk="undefined"==typeof t?null:t,null===this._pk?this._init():this.$load()}function e(t,e,n){var o=t[e],r=when.sequence(o,n).then(function(){return when.resolve(n)});return t[e]=[],r}function n(t,e){Object.keys(e).forEach(function(n){t[n]=e[n]})}t.prototype._init=function(){},t.prototype._load=function(){},t.prototype._create=function(){},t.prototype._update=function(){},t.prototype._delete=function(){},t.prototype._process=function(t){return t},t.prototype._unprocess=function(t){return t},t.prototype.$load=function(){var t=this;return null!==this._remoteData?when.resolve(this):this._load().then(function(o){return t._remoteData=o,n(t,t._process(o)),e(t._eventQueue,"loaded",t)})},t.prototype.$reset=function(){Object.keys(this).filter(function(t){return-1===this._filteredProperties.indexOf(t)},this).forEach(function(t){"undefined"==typeof this._remoteObject[t]?delete this[t]:this[t]=this._remoteObject[t]},this)},t.prototype.$save=function(t){var o=this;return this._pk?this._update(t||this.$raw()).then(function(){return o._remoteData=o.$raw(!0),when.resolve(o)}):this._create(t||this.$raw()).then(function(t,r){return o._pk=t,o._remoteData=r,n(o,o._process(r)),e(o._eventQueue,"created",o).then(e.bind(void 0,o._eventQueue,"loaded",o))})},t.prototype.$delete=function(){var t=this;return this._delete().then(function(){return t._remoteData=null,e(t._eventQueue,"deleted")})},t.prototype.$raw=function(t){var e;return"undefined"==typeof t&&(t=!0),e=t?this._unprocess(this):{},Object.keys(this).filter(function(t){return-1===this._filteredProperties.indexOf(t)&&!e.hasOwnProperty(t)},this).forEach(function(t){e[t]=this[t]instanceof Array?this[t].slice():this[t]},this),raw},t.prototype.$once=function(t,e){if(!this._eventQueue[t])throw new Error(t+" is not a valid event");this._eventQueue[t].push(e)},t.define=function(e){var n,o=["_constructor","_init","_load","_create","_update","_delete","_process","_unprocess"];return n="undefined"!=typeof e._constructor?e._constructor:function(e){t.call(this,e)},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,Object.keys(e).filter(function(t){if(-1===o.indexOf(t))throw new Error("property "+t+" is not definable");if("function"!=typeof e[t])throw new Error("property "+t+" should be a function");return"constructor"!==t}).forEach(function(t){n.prototype[t]=e[t]}),n},"undefined"!=typeof exports?exports=t:window.FuryModel=t}(),function(){"use strict";function t(t){this._model=t,this._instances={}}t.prototype.create=function(){var t=this,e=new this._model;return e.$once("created",function(){t._instances[e._pk]=e}),e},t.prototype.get=function(t){var e=this;return"undefined"===this._instances[id]&&(this._instances[id]=new this._model(t),this._instances[id].$once("deleted",function(){delete e._instances[id]})),this._instances[id]},t.define=function(e,n){var o;return o="undefined"!=typeof n._constructor?n._constructor:function(e){t.call(this,e)},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,Object.keys(n).filter(function(t){return"constructor"!==t}).forEach(function(t){o.prototype[t]=n[t]}),new o(e)},"undefined"!=typeof exports?exports=t:window.FuryFactory=t}();
//# sourceMappingURL=FuryModel.min.js.map